@class NSString, IDSService, CHManager, NSMutableDictionary, NSSet, IMNickname, NSMutableSet, IDSKVStore, NSMutableArray, NSDictionary;

@interface IMDNicknameController : NSObject <IMUnlockMonitorListener, IDSServiceDelegate>

@property (retain, nonatomic) IDSKVStore *cloudkitRecordsKVStore;
@property (nonatomic) double lastMeContactStoreSync;
@property (retain, nonatomic) IDSKVStore *pendingNicknameUpdatesKVStore;
@property (retain, nonatomic) IDSKVStore *handledNicknamesKVStore;
@property (retain, nonatomic) IDSKVStore *archivedNicknamesKVStore;
@property (retain, nonatomic) IDSKVStore *unknownSenderRecordInfoKVStore;
@property (retain, nonatomic) IDSKVStore *handleSharingKVStore;
@property (retain, nonatomic) IDSKVStore *nicknameRecordsKVStore;
@property (retain, nonatomic) NSMutableDictionary *pendingNicknameUpdates;
@property (retain, nonatomic) NSMutableSet *handleTransitionedList;
@property (retain, nonatomic) NSMutableDictionary *activeNicknameRecords;
@property (retain, nonatomic) NSMutableDictionary *ignoredNicknameRecords;
@property (retain, nonatomic) NSMutableDictionary *handledNicknames;
@property (retain, nonatomic) NSMutableDictionary *archivedNicknames;
@property (retain, nonatomic) NSMutableDictionary *unknownSenderRecordInfo;
@property (retain, nonatomic) NSMutableSet *handleAllowList;
@property (retain, nonatomic) NSMutableSet *handleDenyList;
@property (retain, nonatomic) IMNickname *personalNickname;
@property (nonatomic) BOOL needToLoadMapsInfoFromDisk;
@property (retain, nonatomic) NSMutableArray *chatsToSendNicknameInfoTo;
@property (nonatomic) BOOL nicknameIsUploadingToCK;
@property (retain, nonatomic) IDSService *nicknameService;
@property (retain, nonatomic) CHManager *callHistoryManager;
@property (readonly, nonatomic) NSSet *allowListedHandlesForSharing;
@property (readonly, nonatomic) NSSet *denyListedHandlesForSharing;
@property (readonly, nonatomic) NSSet *transitionedHandles;
@property (readonly, nonatomic) NSDictionary *activeRecords;
@property (readonly, nonatomic) NSDictionary *ignoredRecords;
@property (readonly) unsigned long long hash;
@property (readonly) Class superclass;
@property (readonly, copy) NSString *description;
@property (readonly, copy) NSString *debugDescription;

+ (id)sharedInstance;

- (BOOL)_sendMessageDictionary:(id)a0 toDevice:(id)a1 sendType:(unsigned long long)a2;
- (id)wallpaperDataTag;
- (void)currentPersonalNicknameWithRecordID:(id)a0 decryptionKey:(id)a1 wallpaperDataTag:(id)a2 wallpaperLowResDataTag:(id)a3 wallpaperMetadataTag:(id)a4 avatarRecipeDataTag:(id)a5 completionBlock:(id /* block */)a6;
- (void)queueChatToSendNicknamePostUploadIfNeeded:(id)a0;
- (void)sendPersonalNicknameToRecipients:(id)a0 chatGUID:(id)a1 fromHandle:(id)a2 onlySendToThoseLoggedOutOfIMessage:(BOOL)a3;
- (void)_storePendingNicknameForUpload:(id)a0;
- (void)_updateActiveNicknameRecordsListIfNeeded:(id)a0;
- (void)getNicknameWithRecordID:(id)a0 decryptionKey:(id)a1 wallpaperDataTag:(id)a2 wallpaperLowResDataTag:(id)a3 wallpaperMetadataTag:(id)a4 avatarRecipeDataTag:(id)a5 isKnownSender:(BOOL)a6 shouldDecodeImageFields:(BOOL)a7 completionBlock:(id /* block */)a8;
- (void)sendNicknamePreferencesDidChange;
- (void)_updateDenyAllowListHandlesVersion;
- (void)_updateMessageDictionaryWithNicknameUpdateRecordIDs:(id)a0;
- (void)_deleteDataUnderScrutiny;
- (void)_updateHandleList:(id)a0 withHandles:(id)a1 forKey:(id)a2 broadcastUpdates:(BOOL)a3;
- (void)sendNameOnlyToHandleIDs:(id)a0 fromHandleID:(id)a1;
- (void)markHandlesAsAllowed:(id)a0;
- (void)_clearSharingLists;
- (void)clearPendingNicknamePhotoForHandleID:(id)a0;
- (void)dealloc;
- (void)_storePublicNickname:(id)a0 nicknameLocation:(id)a1 encryptionKey:(id)a2 wallpaperDataTag:(id)a3 wallpaperLowResDataTag:(id)a4 wallpaperMetadataTag:(id)a5 avatarRecipeDataTag:(id)a6;
- (void)_syncHandleAllowDenyListToOtherDevices;
- (BOOL)_deviceUnderFirstUnlock;
- (id)_typeOfNicknameUpdateToShare;
- (void)NicknameWithRecordID:(id)a0 URI:(id)a1 decryptionKey:(id)a2 wallpaperDataTag:(id)a3 wallpaperLowResDataTag:(id)a4 wallpaperMetadataTag:(id)a5 avatarRecipeDataTag:(id)a6 hasWallpaperUpdate:(BOOL)a7 dropNicknameForUnknownContacts:(BOOL)a8 withCompletionBlock:(id /* block */)a9;
- (void)_retryPeerRequestWithRetry:(unsigned long long)a0;
- (id)lowResWallpaperDataTag;
- (BOOL)_isUnderScrutiny;
- (void)markNicknamesAsTransitionedForHandleIDs:(id)a0 isAutoUpdate:(BOOL)a1;
- (void)sendPersonalNicknameToRecipients:(id)a0 chatGUID:(id)a1 fromHandle:(id)a2;
- (BOOL)_populateNicknameDictionary:(id)a0 forKVStore:(id)a1 limitToLoad:(unsigned long long)a2;
- (void)_clearIgnoredNicknameRecords;
- (unsigned long long)_reuploadLocalProfileVersionNumber;
- (void)newDeviceDidSignIntoiMessage;
- (void)_updateMessageDictionaryWithPendingNicknameUpdates:(id)a0;
- (void)_makeAllNicknameContentsClassC;
- (void)markNicknameAsUpdated:(id)a0;
- (void)_updateTransitionList:(id)a0 withHandles:(id)a1 forKey:(id)a2 broadcastUpdates:(BOOL)a3;
- (void)_clearActiveNicknameRecords;
- (BOOL)_requestingToSendLocalNicknameInfo:(id)a0;
- (id)_idsDeviceFromPushToken:(id)a0;
- (void)acceptPendingNicknameForHandleID:(id)a0 updateType:(unsigned long long)a1;
- (id)nickNameRecordID;
- (void)_resetHandleSharingList;
- (void)setPersonalNickname:(id)a0 completionBlock:(id /* block */)a1;
- (void)sendPersonalNicknameToRecipients:(id)a0 chatGUID:(id)a1 fromHandle:(id)a2 onlyUseNicknameSendingService:(BOOL)a3 onlySendToThoseLoggedOutOfIMessage:(BOOL)a4;
- (void)deviceSignedOutOfiMessage;
- (void)_updateNicknameInHandledMap:(id)a0 updateType:(unsigned long long)a1 broadcastUpdates:(BOOL)a2;
- (void)_ckAccountChanged:(id)a0;
- (void)_getDevicesForBothNicknameServices:(id)a0 removeNewServiceURIsFromIMessageList:(BOOL)a1 completionHandler:(id /* block */)a2;
- (void)_uploadPendingNicknameIfNecessary;
- (void)broadcastHandlesSharingNicknamesDidChange;
- (void)_updateNameOnlyUpdateForMessage:(id)a0 fromHandleID:(id)a1;
- (void)_updateHandleDenyAllowListIfNeeded:(id)a0;
- (void)loadPersonalNicknameIfNeeded;
- (void)_removeFromTransitionedList:(id)a0;
- (id)_diffActiveRecords:(id)a0 againstPrevious:(id)a1;
- (void)clearPendingNicknameForHandleID:(id)a0;
- (void)loadUnknownSenderRecordInfoFromKVStore;
- (id)nicknameForRecordID:(id)a0;
- (void)verifyTruncatedRecordIDMatchesPersonalNickname:(id)a0 forChat:(id)a1;
- (void)denyHandlesForSharing:(id)a0;
- (void)sendPersonalNicknameToRecipients:(id)a0 chatGUID:(id)a1 fromHandle:(id)a2 onlyUseNicknameSendingService:(BOOL)a3;
- (id)init;
- (BOOL)evaluateAccountStateForFeatureEligibility;
- (void)_deleteHandleIDFromPendingMap:(id)a0;
- (void)_deletePublicNicknameLocationAndKey;
- (void)saveNicknameForRecordID:(id)a0 handleID:(id)a1 userNickname:(id)a2;
- (void)_updateIsIgnoredListHandlesVersion;
- (id)newNicknameInfoToSend;
- (id)_getPendingNicknameForUpload;
- (void)_broadcastNicknamesMapChanged;
- (void)_syncHandleTransitionedListToOtherDevices;
- (id)storedPersonalNickname;
- (void)_updateTransitionedListHandlesVersion;
- (void)_updateCloudKitRecordIDAndDecryptionKeyIfNeeded:(id)a0;
- (void)_replaceUnknownSenderRecordInfoListWithInfo:(id)a0 purgeIfNeeded:(BOOL)a1;
- (id)nicknameForHandleURI:(id)a0;
- (void)_beginNicknameUpload:(id)a0;
- (id)loadListForKey:(id)a0 list:(id)a1;
- (id)nicknameForHandle:(id)a0;
- (id)wallpaperMetadataTag;
- (void)_updateHandleTransitionedListIfNeeded:(id)a0;
- (void)deleteAllPersonalNicknames:(BOOL)a0 withCompletion:(id /* block */)a1;
- (void)_updatePendingNicknameVersion;
- (void)_showDebugAlertWithHeader:(id)a0 message:(id)a1;
- (void)_deletePendingNicknameForUpload;
- (void)sendPersonalNicknameRecordIDAndVersionRequestedByDevice:(id)a0;
- (void)aliasesDidChange:(BOOL)a0;
- (id)pendingPersonalNickname;
- (void)_markCurrentNicknameAsArchived:(id)a0 incrementPendingNicknameVersion:(BOOL)a1;
- (void)_newDeviceDidSignIntoiMessageWithRetryCount:(unsigned long long)a0;
- (void)_deleteHandleIDFromArchivedMap:(id)a0;
- (void)_updateNicknameInArchivedMap:(id)a0;
- (void)_deleteNicknameFromPendingMap:(id)a0;
- (void)reuploadProfileIfNeeded;
- (id)nickNameDecryptionKey;
- (id)defaults;
- (BOOL)_nicknameFeatureEnabled;
- (void)handleNicknameUpdatesFromPeerDevice:(id)a0 fromPeerDevice:(id)a1;
- (void)ignorePendingNicknameForHandleID:(id)a0;
- (BOOL)_isActiveForNickname:(id)a0;
- (void)_updateNicknameListsIfNeeded:(id)a0;
- (void)_deleteHandleIDFromHandledMap:(id)a0;
- (void)sendPersonalNicknameRecordIDAndVersionToAllPeers;
- (id)substringRecordIDForNickname:(id)a0;
- (void)loadHandledTransitioned;
- (void)_syncActiveNicknameRecordsToOtherDevices;
- (id)unknownSenderRecordInfoFor:(id)a0;
- (void)purgeUnknownSenderRecordInfoIfNeeded;
- (void)cleanUpNicknameForIDs:(id)a0;
- (void)_clearTransitionedList;
- (void)markProfileRecordsAsIgnored:(id)a0 broadcastUpdates:(BOOL)a1;
- (id)transferServicesController;
- (void)_syncIgnoredNicknameRecordsToOtherDevices;
- (void)currentPersonalNicknamewithCompletionBlock:(id /* block */)a0;
- (void)systemDidLeaveFirstDataProtectionLock;
- (void)_markPendingNicknameAsCurrent:(id)a0 incrementPendingNicknameVersion:(BOOL)a1 updateType:(unsigned long long)a2 broadcastUpdates:(BOOL)a3;
- (id)messageDictionaryWithPersonalRecordIDAndVersion;
- (id)avatarRecipeTag;
- (id)nicknameForRecordID:(id)a0 handle:(id)a1;
- (void)markProfileRecords:(id)a0 asActive:(BOOL)a1;
- (BOOL)_sendMessageDictionary:(id)a0 toDevice:(id)a1;
- (void)loadSharingHandlesPrefs;
- (void)_markNicknamePhotoAsUpdated:(id)a0;
- (void)_deleteOnDiskDataIfNeededForNickname:(id)a0 withNewNickname:(id)a1;
- (void)_setUnderScrutiny:(BOOL)a0;
- (void)sendPendingNicknameUpdatesDidChange;
- (void)_updateSharingPreferencesIfNeededFromMadridMessage:(id)a0;
- (void)service:(id)a0 account:(id)a1 incomingTopLevelMessage:(id)a2 fromID:(id)a3 messageContext:(id)a4;
- (void)_updateIgnoredList:(id)a0 withRecords:(id)a1 broadcastUpdates:(BOOL)a2;
- (void)_updateIgnoredNicknameRecordsListIfNeeded:(id)a0;
- (void)_deleteAvatarForNickname:(id)a0;
- (void)_evaluateIfAccountHasMultiplePhoneNumbers;
- (void)_updateIsActiveListHandlesVersion;
- (void)allowHandlesForSharing:(id)a0 onChatGUIDs:(id)a1 fromHandle:(id)a2 forceSend:(BOOL)a3;
- (void)loadNicknamesFromKVStore;
- (BOOL)replacedNicknameForHandleIDInHandledMapIfNeeded:(id)a0 nickname:(id)a1;
- (void)addNicknameToPendingUpdates:(id)a0;
- (void)_loadAllInfoFromDiskIfAble;
- (void)_broadcastActiveListChanged;
- (void)_removeFromList:(id)a0 withKey:(id)a1;
- (void).cxx_destruct;
- (BOOL)_isNicknamesSharingEnabled;
- (void)markAllNicknamesAsPending;
- (void)_endNicknameUpload;
- (void)_tryToReuploadPersonalNicknameWithRetryCount:(unsigned long long)a0 reuploadVersion:(unsigned long long)a1;
- (void)_updateActiveList:(id)a0 withRecords:(id)a1 broadcastUpdates:(BOOL)a2;
- (void)broadcastTransitionedHandlesDidChange;
- (id)allNicknames;
- (void)_writeNicknameToKVStore:(id)a0 nickname:(id)a1;

@end
