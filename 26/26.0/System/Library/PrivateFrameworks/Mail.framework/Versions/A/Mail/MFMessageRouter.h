@class MFMessageActionHandler, NSArray, MFMessageStore, NSString, NSConditionLock, NSDictionary, NSObject, NSMutableArray, MFMessageRule;
@protocol OS_os_log, EFScheduler, EFCancelable;

@interface MFMessageRouter : NSObject <NSCopying, MCActivityTarget, EFLoggable> {
    NSMutableArray *_queuedMessages;
    NSConditionLock *_queuedMessagesFull;
    NSConditionLock *_queuedMessagesEmpty;
    NSConditionLock *_queuedMessagesRouting;
    unsigned long long _bytesInQueue;
    unsigned long long _queueSize;
    BOOL _routingThreadShouldQuit;
    id<EFCancelable> _junkMailTrustHeadersObservationToken;
    id<EFCancelable> _junkMailEvaluationAfterRulesObservationToken;
    MFMessageRule *_junkRule;
    MFMessageRule *_safeToMarkAsNotJunkRule;
    MFMessageRule *_blockedSenderRule;
    NSArray *_defaultRules;
    NSArray *_sortRules;
    NSMutableArray *_requiredHeaderKeys;
    BOOL _registeredForMailboxNotifications;
    BOOL _junkMailTrustHeaders;
    BOOL _junkMailEvaluationAfterRules;
    NSDictionary *_junkMailHeaderFlags;
    long long _colorChangeCounter;
    long long _syncState;
    BOOL _isDirty;
    NSMutableArray *_unrecognizedRules;
}

@property (class, readonly, nonatomic) MFMessageRouter *sharedInstance;
@property (class, readonly, nonatomic) NSArray *defaultAppleEmailAddresses;
@property (class) long long junkMailBehavior;
@property (class, readonly) NSObject<OS_os_log> *log;

@property (nonatomic) unsigned long long numMessagesRoutedSoFar;
@property (readonly, nonatomic) id<EFScheduler> writeRulesScheduler;
@property (nonatomic) long long colorChangeCounter;
@property (readonly, nonatomic) BOOL colorsUpdateDynamically;
@property (readonly, copy) NSArray *headersRequiredForRouting;
@property (retain) MFMessageRule *junkMailRule;
@property (retain) MFMessageRule *blockedSenderRule;
@property long long junkMailBehavior;
@property (nonatomic) BOOL junkMailTrustHeaders;
@property (nonatomic) BOOL junkMailEvaluationAfterRules;
@property (readonly, copy, nonatomic) NSDictionary *junkMailHeaderFlags;
@property (weak, nonatomic) MFMessageStore *store;
@property (nonatomic) unsigned long long estimatedNumberOfMessagesToRoute;
@property (readonly) NSArray *rules;
@property (readonly) unsigned long long numberOfRules;
@property (readonly, nonatomic) MFMessageActionHandler *messageActionHandler;
@property (readonly, copy, nonatomic) NSString *displayName;
@property (readonly) unsigned long long hash;
@property (readonly) Class superclass;
@property (readonly, copy) NSString *description;
@property (readonly, copy) NSString *debugDescription;

+ (void)saveRulesIfNeeded;

- (void)removeRule:(id)a0;
- (id)copyWithZone:(struct _NSZone { } *)a0;
- (id)init;
- (void)addRule:(id)a0;
- (void).cxx_destruct;
- (id)defaultRules;
- (id)ruleAtIndex:(unsigned long long)a0;
- (id)_setupSortRules;
- (void)_accountWillBeDeleted:(id)a0;
- (void)_applyRulesToMailboxes:(id)a0;
- (BOOL)_colorRuleExistsAfterRule:(id)a0;
- (id)_defaultSortRules;
- (void)_diagnosticsNotificationReceived:(id)a0;
- (BOOL)_hasColorRules;
- (id)_junkMailRuleForBehavior:(long long)a0 abCriterion:(BOOL)a1 ahCriterion:(BOOL)a2 fnCriterion:(BOOL)a3;
- (void)_mailboxBecameInvalid:(id)a0;
- (void)_mailboxListingChanged:(id)a0;
- (void)_mailboxWasRenamed:(id)a0;
- (void)_messageActionProvidersDidChange:(id)a0;
- (void)_putRulesThatWantToHandleMessage:(id)a0 intoArray:(id)a1 colorRulesOnly:(BOOL)a2 fetchingBody:(BOOL)a3 shouldForceEvaluatingRules:(BOOL)a4 needsBody:(BOOL *)a5;
- (id)_readRulesFromDisk;
- (BOOL)_routeMessagesIndividually;
- (void)_routeQueuedMessages;
- (id)_ruleDescriptionsFromDictionaryRepresentations:(id)a0;
- (id)_rules;
- (id)_safeToMarkAsNotJunkRule;
- (void)_setRules:(id)a0;
- (void)_setWriteRulesTimer:(id)a0;
- (id)_sortRuleDictionaryRepresentationsIncludingPII:(BOOL)a0;
- (id)_sortRulesFromDictionaryRepresentations:(id)a0;
- (void)_synchronouslyWriteRulesToDisk;
- (void)_synchronouslyWriteRulesToDiskIfNeeded;
- (void)_unScheduleWriteRules;
- (void)_updateUnrecognizedRulesAfterAddingIndex:(unsigned long long)a0;
- (void)_updateUnrecognizedRulesAfterRemovingIndex:(unsigned long long)a0;
- (void)_writeRulesToDiskInBackground:(id)a0;
- (id)activeRules;
- (void)applyRulesAsynchronouslyToMailboxes:(id)a0;
- (void)asynchronouslyRouteMessages:(id)a0;
- (id)colorForMessage:(id)a0 highlightTextUsingColor:(BOOL *)a1;
- (void)enqueueColorRulesDidChange;
- (void)headersRequiredForRoutingDidChange;
- (void)insertRule:(id)a0 atIndex:(unsigned long long)a1;
- (id)instanceForRouting;
- (void)loadDestinationMailboxes;
- (void)mailboxWillBeRenamedOrInvalidated;
- (unsigned long long)numberOfDefaultRules;
- (void)reloadRules;
- (void)removeRuleAtIndex:(unsigned long long)a0;
- (void)routeJunkMessagesInMailboxes:(id)a0;
- (id)routeMessages:(id)a0 fromStores:(id)a1 fetchingBodies:(BOOL)a2 messagesNeedingBodies:(id)a3 shouldForceEvaluatingRules:(BOOL)a4;
- (void)ruleAffectingColorsDidChange:(id)a0;
- (void)ruleDidChange:(id)a0;
- (void)scheduleWriteRules;
- (id)test_routeMessages:(id)a0 fromStores:(id)a1 fetchingBodies:(BOOL)a2 messagesNeedingBodies:(id)a3;
- (void)test_waitForWrites;
- (void)tryToReconnectAutoDeactivatedRules;
- (void)waitForRoutingToFinish;

@end
